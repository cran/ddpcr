<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Dean Attali" />

<meta name="date" content="2020-06-01" />

<title>Extending ddpcr by adding new plate types</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Extending ddpcr by adding new plate types</h1>
<h4 class="author">Dean Attali</h4>
<h4 class="date">2020-06-01</h4>



<div id="extending-ddpcr-by-adding-new-plate-types" class="section level1">
<h1>Extending ddpcr by adding new plate types</h1>
<p>While this package was developed as a tool to facilitate the analysis of some specific types of ddPCR data, it was implemented in a way that easily allows users to add custom ddPCR plate types through <em>S3 inheritance</em> (see <a href="./technical_details.Rmd">the <em>Technical details</em> vignette</a> for more details). The basic concept is that every plate type has a parent plate type, from which it inherits all features, but can be made more specific or add/modify its behaviour. Inheritance is transitive (features are inherited from all ancestors, not only the most immediate one), but a plate can only have one parent (multiple inheritance is not supported).</p>
<div id="default-plate-type-ddpcr_plate" class="section level2">
<h2>Default plate type: ddpcr_plate</h2>
<p>The most basic plate type is <code>ddpcr_plate</code>, and every plate type inherits from it, either directly or by inheriting from other plate types that are descendants of <code>ddpcr_plate</code>. This is handy because it means that all functionality that is common to all ddPCR types is implemented once for <code>ddpcr_plate</code> and can be used by all plate types, unless a plate type specifically removes or modifies some behaviour. Every plate type by default inherits all methods that <code>ddpcr_plate</code> has, which can be found by running <code>methods(class = &quot;ddpcr_plate&quot;)</code>. If you create a new plate type and no parent is specified, or if you initialize a ddPCR plate without specifying a plate type, then <code>ddpcr_plate</code> is assumed.</p>
<p>Calling the <code>analyze()</code> function on any plate will result in running the ddPCR data through a series of <em>steps</em> that are defined for the given plate type, and the droplets in the data will be assigned to one of several <em>clusters</em> associated with the given plate type.</p>
<p>Plates of type <code>ddpcr_plate</code> have 4 possible clusters: <code>UNDEFINED</code> for any droplet that has not been assigned a cluster yet, <code>FAILED</code> for droplets in failed wells, <code>OUTLIER</code> for outlier droplets, and <code>EMPTY</code> for droplets without any template in them. This information can also be seen with the <code>clusters()</code> function.</p>
<p>Plates of type <code>ddpcr_plate</code> have 4 analysis steps: <code>INITIALIZE</code>, <code>REMOVE_FAILURES</code>, <code>REMOVE_OUTLIERS</code>, and <code>REMOVE_EMPTY</code>. This means that any plate that is created will perform these basic steps of removing failed wells, outlier droplets, and empty droplets. The exact functions used for each step can be seen with the <code>steps()</code> function. For example, <code>new_plate(sample_data_dir()) %&gt;% steps</code> will reveal that the <code>REMOVE_FAILURES</code> steps calls the function <code>remove_failures()</code>, so you can view the algorithm by running <code>ddpcr:::remove_failures.ddpcr_plate</code>.</p>
<p>Plates of type <code>ddpcr_plate</code> also have a set of parameters that can be viewed with the <code>params()</code> function. Running <code>new_plate(sample_data_dir()) %&gt;% params %&gt;% str</code> will show all the default parameters that are used. Any of these parameters can be overridden in new plate types, and new parameters can be added.</p>
</div>
<div id="built-in-plate-types" class="section level2">
<h2>Built-in plate types</h2>
<p>The default plate type is the common base for all built-in types, but because it is not specific to any particular ddPCR data, it does not do any droplet gating, as that is highly dependent on the type of data. The default type is useful for pre-processing, exploring, and visualizing any ddPCR data. There are other built-in plate types available, and you can see a list through the <code>plate_types</code> variable. You can learn more about the built-in plate types and what kind of ddPCR data is suitable for each one by viewing its documentation with <code>?plate_types</code>. If none of the built-in plate types are useful for your data, you can create a new plate type with custom analysis steps or parameters.</p>
</div>
<div id="functions-to-implement-when-adding-a-new-plate-type" class="section level2">
<h2>Functions to implement when adding a new plate type</h2>
<p>If you want to add a new plate type, there are a few functions you need to implement. All these functions take one argument: a <code>ddpcr_plate</code> object. Note that all these functions are S3 generics, so you need to follow the S3 method naming scheme.</p>
<div id="parent_plate_type-define-parent-plate-type" class="section level3">
<h3><code>parent_plate_type()</code>: Define parent plate type</h3>
<p>Each ddPCR plate has a “parent” plate type from which it inherits all its properties. When creating a custom plate type, you should define this function and simply return the parent plate type. If you don’t define this function, the parent plate type is assumed to be the base type of <code>ddpcr_plate</code>. Inheriting from a parent plate means that the same cluster types, analysis steps, and parameters will be used by default.</p>
</div>
<div id="define_params-define-plate-type-parameters" class="section level3">
<h3><code>define_params()</code>: Define plate type parameters</h3>
<p>Every ddPCR plate type has a set of default parameters. When creating a custom plate type, if your plate type needs a different set of parameters than its parent type, you must define this function and have it return the parameters specific to this plate. When defining this function, you can use <code>NextMethod(&quot;define_params&quot;)</code> to get a list of the parameters of the parent type so that you can simply add to that list rather than redefining all the parameters.</p>
</div>
<div id="define_clusters-define-droplet-clusters" class="section level3">
<h3><code>define_clusters()</code>: Define droplet clusters</h3>
<p>Every ddPCR plate type has a set of potential clusters the droplets can be assigned to. When creating a custom plate type, if your plate type uses a different set of clusters than its parent type, you must define this function and have it return the cluster names. When defining this function, you can use <code>NextMethod(&quot;define_clusters&quot;)</code> to get a list of the clusters available in the parent type if you want to simply add new clusters without defining all of them.</p>
</div>
<div id="define_steps-define-analysis-steps" class="section level3">
<h3><code>define_steps()</code>: Define analysis steps</h3>
<p>Every ddPCR plate type has an ordered set of steps that are run to analyze the data. When creating a new plate type, if your plate type has different analysis steps than its parent type, you must define this function and have it return a named list of the analysis steps. When defining this function, you can use <code>NextMethod(&quot;define_steps&quot;)</code> to get a list of the steps available in the parent type if you want to simply add new steps without defining all of them. Any step that you define must have an associated function with the same name that takes a ddPCR plate as an argument and returns the ddPCR plate after running the given step on it. Most analysis steps will usually change the plate’s metadata (<code>?plate_meta</code>) and the droplet cluster assignments (<code>?plate_data</code>). See the example below for helper functions that are available when writing code for an analysis step.</p>
</div>
<div id="changing-the-algorithm-of-an-existing-step" class="section level3">
<h3>Changing the algorithm of an existing step</h3>
<p>With the <code>define_steps()</code> function you can define new analysis steps that are unique to your new plate type. It can also be desirable to simply change the implementation of an existing step instead of creating a new step. For example, any ddPCR plate will, by default, use the <code>ddpcr:::remove_failures.ddpcr_plate</code> function as the algorithm for flagging failed wells. If your plate type has a specific way of flagging failed wells, you can overwrite this step by defining a new S3 generic function for your plate type.</p>
</div>
<div id="plot-plot-a-ddpcr-plate" class="section level3">
<h3><code>plot()</code>: Plot a ddPCR plate</h3>
<p>The default plot function provided by <code>ddpcr_plate</code> will usually be enough to convey your ddPCR plate information. If there is anything specific you want to add to plots of your new plate type, you can define this function. It is recommended to build on top of the output of the default plot function, rather than start a complete new plot. This can be done by having the first line of code being <code>p &lt;- NextMethod(&quot;plot&quot;)</code> and adding plot elements on top of <code>p</code>. Note that <code>ggplot2</code> is the default plotting library. Read the help section of the default plot to learn more <code>?plot.ddpcr_plate</code>.</p>
</div>
</div>
<div id="example" class="section level2">
<h2>Example</h2>
<p>As a simple exercise to show how easy it is to create a new plate type, this section will walk through the steps required to create a new plate type. The name of the new plate type is <code>fam_border</code>. In experiments of this type, we are interested in running the typical pre-processing (identify failed wells, outlier droplets, and empty droplets), followed by simply classifying the remaining droplets as either FAM-positive or FAM-negative, with the border between positive and negative being a predefined value. This plate type is clearly not very useful but it is good for demonstration purposes.</p>
<p>The first thing to do is to define the parent plate type, which in this case will be <code>ddpcr_plate</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>parent_plate_type.fam_border &lt;-<span class="st"> </span><span class="cf">function</span>(plate) {</span>
<span id="cb1-2"><a href="#cb1-2"></a>  <span class="st">&quot;ddpcr_plate&quot;</span></span>
<span id="cb1-3"><a href="#cb1-3"></a>}</span></code></pre></div>
<p>The next step is to define the parameters of this plate type. ddPCR plates of this type are expected to have at least 14,000 droplets per well as a QA metric. If any well has fewer droplets, it is considered a failure. There is already a parameter for this, so we just need to modify it. We also add a new parameter for the border to use for gating the droplets, and give it a default value.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>define_params.fam_border &lt;-<span class="st"> </span><span class="cf">function</span>(plate) {</span>
<span id="cb2-2"><a href="#cb2-2"></a>  params &lt;-<span class="st"> </span><span class="kw">NextMethod</span>(<span class="st">&quot;define_params&quot;</span>)</span>
<span id="cb2-3"><a href="#cb2-3"></a>  </span>
<span id="cb2-4"><a href="#cb2-4"></a>  new_params &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb2-5"><a href="#cb2-5"></a>    <span class="st">&#39;REMOVE_FAILURES&#39;</span> =<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb2-6"><a href="#cb2-6"></a>      <span class="st">&#39;TOTAL_DROPS_T&#39;</span> =<span class="st"> </span><span class="dv">14000</span>  <span class="co"># overwriting an existing parameter</span></span>
<span id="cb2-7"><a href="#cb2-7"></a>    ),</span>
<span id="cb2-8"><a href="#cb2-8"></a>    <span class="st">&#39;GATE&#39;</span> =<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb2-9"><a href="#cb2-9"></a>      <span class="st">&#39;FAM_BORDER&#39;</span> =<span class="st"> </span><span class="dv">5000</span>  <span class="co"># defining a new parameter</span></span>
<span id="cb2-10"><a href="#cb2-10"></a>    )</span>
<span id="cb2-11"><a href="#cb2-11"></a>  )</span>
<span id="cb2-12"><a href="#cb2-12"></a>  params &lt;-<span class="st"> </span><span class="kw">modifyList</span>(params, new_params)</span>
<span id="cb2-13"><a href="#cb2-13"></a>  </span>
<span id="cb2-14"><a href="#cb2-14"></a>  params</span>
<span id="cb2-15"><a href="#cb2-15"></a>}</span></code></pre></div>
<p>Next we define the potential droplet clusters. We use the same clusters as the default plate type and add two more, to denote droplets in the FAM-positive and FAM-negative sections.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>define_clusters.fam_border &lt;-<span class="st"> </span><span class="cf">function</span>(plate) {</span>
<span id="cb3-2"><a href="#cb3-2"></a>  clusters &lt;-<span class="st"> </span><span class="kw">NextMethod</span>(<span class="st">&quot;define_clusters&quot;</span>)</span>
<span id="cb3-3"><a href="#cb3-3"></a>  </span>
<span id="cb3-4"><a href="#cb3-4"></a>  <span class="kw">c</span>(clusters,</span>
<span id="cb3-5"><a href="#cb3-5"></a>    <span class="st">&#39;FAM_POSITIVE&#39;</span>,</span>
<span id="cb3-6"><a href="#cb3-6"></a>    <span class="st">&#39;FAM_NEGATIVE&#39;</span></span>
<span id="cb3-7"><a href="#cb3-7"></a>  )</span>
<span id="cb3-8"><a href="#cb3-8"></a>}</span></code></pre></div>
<p>Next we define the analysis steps. We use all the default analysis steps (pre-processing steps), and add a gating step.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>define_steps.fam_border &lt;-<span class="st"> </span><span class="cf">function</span>(plate) {</span>
<span id="cb4-2"><a href="#cb4-2"></a>  steps &lt;-<span class="st"> </span><span class="kw">NextMethod</span>(<span class="st">&quot;define_steps&quot;</span>)</span>
<span id="cb4-3"><a href="#cb4-3"></a>  </span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="kw">c</span>(steps,</span>
<span id="cb4-5"><a href="#cb4-5"></a>    <span class="kw">list</span>(</span>
<span id="cb4-6"><a href="#cb4-6"></a>      <span class="st">&#39;GATE&#39;</span> =<span class="st"> &#39;gate_droplets&#39;</span></span>
<span id="cb4-7"><a href="#cb4-7"></a>    ))</span>
<span id="cb4-8"><a href="#cb4-8"></a>}</span></code></pre></div>
<p>We need to create the <code>gate_droplets</code> function with the actual logic that will perform the step. Notice the use of the following helper functions that are especially useful when writing analysis step functions: <code>step</code>, <code>check_step</code>, <code>step_begin</code>, <code>step_end</code>, <code>unanalyzed_clusters</code>, and <code>status</code>. You can look up the documentation for each of these functions to learn more.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>gate_droplets &lt;-<span class="st"> </span><span class="cf">function</span>(plate) {</span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="co"># make sure this step was not called prematurely</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>  current_step &lt;-<span class="st"> </span><span class="kw">step</span>(plate, <span class="st">&#39;GATE&#39;</span>)</span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="kw">check_step</span>(plate, current_step)  </span>
<span id="cb5-5"><a href="#cb5-5"></a>  </span>
<span id="cb5-6"><a href="#cb5-6"></a>  <span class="co"># show an informative message to the user</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>  <span class="kw">step_begin</span>(<span class="st">&quot;Classifying droplets as FAM-positive or negative&quot;</span>)</span>
<span id="cb5-8"><a href="#cb5-8"></a>  </span>
<span id="cb5-9"><a href="#cb5-9"></a>  data &lt;-<span class="st"> </span><span class="kw">plate_data</span>(plate)</span>
<span id="cb5-10"><a href="#cb5-10"></a>  border &lt;-<span class="st"> </span><span class="kw">params</span>(plate, <span class="st">&#39;GATE&#39;</span>, <span class="st">&#39;FAM_BORDER&#39;</span>)</span>
<span id="cb5-11"><a href="#cb5-11"></a>  </span>
<span id="cb5-12"><a href="#cb5-12"></a>  <span class="co"># get a list of clusters that have not been considered yet in the analysis</span></span>
<span id="cb5-13"><a href="#cb5-13"></a>  <span class="co"># this is useful so that we only look at droplets that have not yet been</span></span>
<span id="cb5-14"><a href="#cb5-14"></a>  <span class="co"># assigned to a cluster</span></span>
<span id="cb5-15"><a href="#cb5-15"></a>  unanalyzed_clusters &lt;-<span class="st"> </span><span class="kw">unanalyzed_clusters</span>(plate, <span class="st">&#39;FAM_POSITIVE&#39;</span>)</span>
<span id="cb5-16"><a href="#cb5-16"></a>  </span>
<span id="cb5-17"><a href="#cb5-17"></a>  <span class="co"># get the indices of all droplets that are FAM-positive and negative</span></span>
<span id="cb5-18"><a href="#cb5-18"></a>  unanalyzed_idx &lt;-<span class="st"> </span>data<span class="op">$</span>cluster <span class="op">%in%</span><span class="st"> </span>unanalyzed_clusters</span>
<span id="cb5-19"><a href="#cb5-19"></a>  fam_pos &lt;-<span class="st"> </span>unanalyzed_idx <span class="op">&amp;</span><span class="st"> </span>data<span class="op">$</span>FAM <span class="op">&gt;=</span><span class="st"> </span>border</span>
<span id="cb5-20"><a href="#cb5-20"></a>  fam_neg &lt;-<span class="st"> </span>unanalyzed_idx <span class="op">&amp;</span><span class="st"> </span>data<span class="op">$</span>FAM <span class="op">&lt;</span><span class="st"> </span>border</span>
<span id="cb5-21"><a href="#cb5-21"></a>  </span>
<span id="cb5-22"><a href="#cb5-22"></a>  <span class="co"># assign each droplet to its cluster</span></span>
<span id="cb5-23"><a href="#cb5-23"></a>  data[fam_pos, <span class="st">&#39;cluster&#39;</span>] &lt;-<span class="st"> </span><span class="kw">cluster</span>(plate, <span class="st">&#39;FAM_POSITIVE&#39;</span>)</span>
<span id="cb5-24"><a href="#cb5-24"></a>  data[fam_neg, <span class="st">&#39;cluster&#39;</span>] &lt;-<span class="st"> </span><span class="kw">cluster</span>(plate, <span class="st">&#39;FAM_NEGATIVE&#39;</span>)</span>
<span id="cb5-25"><a href="#cb5-25"></a>  </span>
<span id="cb5-26"><a href="#cb5-26"></a>  <span class="co"># update the data on the plate object</span></span>
<span id="cb5-27"><a href="#cb5-27"></a>  <span class="kw">plate_data</span>(plate) &lt;-<span class="st"> </span>data</span>
<span id="cb5-28"><a href="#cb5-28"></a>  </span>
<span id="cb5-29"><a href="#cb5-29"></a>  <span class="co"># record how many drops in each well are in each cluster</span></span>
<span id="cb5-30"><a href="#cb5-30"></a>  <span class="co"># and add this info to the plate&#39;s metadata</span></span>
<span id="cb5-31"><a href="#cb5-31"></a>  drops_per_cluster &lt;-<span class="st"> </span></span>
<span id="cb5-32"><a href="#cb5-32"></a><span class="st">    </span>plyr<span class="op">::</span><span class="kw">ddply</span>(data, <span class="op">~</span><span class="st"> </span>well, <span class="cf">function</span>(x) {</span>
<span id="cb5-33"><a href="#cb5-33"></a>      <span class="kw">data.frame</span>(</span>
<span id="cb5-34"><a href="#cb5-34"></a>        <span class="st">&#39;drops_positive&#39;</span> =<span class="st"> </span><span class="kw">sum</span>(x<span class="op">$</span>cluster <span class="op">==</span><span class="st"> </span><span class="kw">cluster</span>(plate, <span class="st">&#39;FAM_POSITIVE&#39;</span>)),</span>
<span id="cb5-35"><a href="#cb5-35"></a>        <span class="st">&#39;drops_negative&#39;</span> =<span class="st"> </span><span class="kw">sum</span>(x<span class="op">$</span>cluster <span class="op">==</span><span class="st"> </span><span class="kw">cluster</span>(plate, <span class="st">&#39;FAM_NEGATIVE&#39;</span>))</span>
<span id="cb5-36"><a href="#cb5-36"></a>      )</span>
<span id="cb5-37"><a href="#cb5-37"></a>    })</span>
<span id="cb5-38"><a href="#cb5-38"></a>  <span class="kw">plate_meta</span>(plate) &lt;-</span>
<span id="cb5-39"><a href="#cb5-39"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">left_join</span>(</span>
<span id="cb5-40"><a href="#cb5-40"></a>      <span class="kw">plate_meta</span>(plate),</span>
<span id="cb5-41"><a href="#cb5-41"></a>      drops_per_cluster,</span>
<span id="cb5-42"><a href="#cb5-42"></a>      <span class="dt">by =</span> <span class="st">&quot;well&quot;</span></span>
<span id="cb5-43"><a href="#cb5-43"></a>    )</span>
<span id="cb5-44"><a href="#cb5-44"></a>  </span>
<span id="cb5-45"><a href="#cb5-45"></a>  <span class="co"># VERY IMPORTANT - do not forget to update the status of the plate</span></span>
<span id="cb5-46"><a href="#cb5-46"></a>  <span class="kw">status</span>(plate) &lt;-<span class="st"> </span>current_step</span>
<span id="cb5-47"><a href="#cb5-47"></a>  <span class="kw">step_end</span>()</span>
<span id="cb5-48"><a href="#cb5-48"></a>  </span>
<span id="cb5-49"><a href="#cb5-49"></a>  plate</span>
<span id="cb5-50"><a href="#cb5-50"></a>}</span></code></pre></div>
<p>Now the new plate type is ready to be used. We can also add a plot function if there are any customizations to the plot that are specific to this plate type. The default plot function of ddPCR plates goes a long way, but one thing we can add is a line showing the division border.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>plot.fam_border &lt;-<span class="st"> </span><span class="cf">function</span>(x, ..., <span class="dt">show_border =</span> <span class="ot">FALSE</span>) {</span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="co"># Plot a regular ddpcr plate</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>  p &lt;-<span class="st"> </span><span class="kw">NextMethod</span>(<span class="st">&quot;plot&quot;</span>, x)</span>
<span id="cb6-4"><a href="#cb6-4"></a>  </span>
<span id="cb6-5"><a href="#cb6-5"></a>  <span class="co"># Show the custom thresholds</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>  <span class="cf">if</span> (show_border) {</span>
<span id="cb6-7"><a href="#cb6-7"></a>    border &lt;-<span class="st"> </span><span class="kw">params</span>(x, <span class="st">&#39;GATE&#39;</span>, <span class="st">&#39;FAM_BORDER&#39;</span>)</span>
<span id="cb6-8"><a href="#cb6-8"></a>    p &lt;-<span class="st"> </span>p <span class="op">+</span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="st">      </span>ggplot2<span class="op">::</span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> border)</span>
<span id="cb6-10"><a href="#cb6-10"></a>  }</span>
<span id="cb6-11"><a href="#cb6-11"></a>  </span>
<span id="cb6-12"><a href="#cb6-12"></a>  p</span>
<span id="cb6-13"><a href="#cb6-13"></a>}</span></code></pre></div>
<p>The one last thing we can add is a convenient way for the user to set the border parameter.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="st">`</span><span class="dt">fam_border&lt;-</span><span class="st">`</span> &lt;-<span class="st"> </span><span class="cf">function</span>(plate, value) {</span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="kw">params</span>(plate, <span class="st">&#39;GATE&#39;</span>, <span class="st">&#39;FAM_BORDER&#39;</span>) &lt;-<span class="st"> </span>value</span>
<span id="cb7-3"><a href="#cb7-3"></a>  plate</span>
<span id="cb7-4"><a href="#cb7-4"></a>}</span></code></pre></div>
<p>Now we can create a new ddPCR plate with the new type and run a full analysis of it.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">library</span>(ddpcr)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;ddpcr&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:stats&#39;:
## 
##     step</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>plate &lt;-<span class="st"> </span><span class="kw">new_plate</span>(<span class="dt">dir =</span> <span class="kw">sample_data_dir</span>(), <span class="dt">type =</span> <span class="st">&quot;fam_border&quot;</span>)</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="kw">fam_border</span>(plate) &lt;-<span class="st"> </span><span class="dv">8000</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>plate &lt;-<span class="st"> </span><span class="kw">analyze</span>(plate)</span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="kw">plot</span>(plate, <span class="dt">show_drops_empty =</span> <span class="ot">TRUE</span>)</span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="kw">plot</span>(plate, <span class="dt">col_drops_fam_negative =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb11-6"><a href="#cb11-6"></a>     <span class="dt">col_drops_fam_positive =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">show_border =</span> <span class="ot">TRUE</span>)</span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="kw">plate_meta</span>(plate, <span class="dt">only_used =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>##   well sample row col used    target_ch1     target_ch2 drops success
## 1  A01   Dean   A   1 TRUE Consensus_FAM WTspecific_HEX 15820    TRUE
## 2  C01   Mike   C   1 TRUE Consensus_FAM WTspecific_HEX 14256    TRUE
## 3  F05   Mary   F   5 TRUE Consensus_FAM WTspecific_HEX 15377    TRUE
## 4  A05   Dave   A   5 TRUE Consensus_FAM WTspecific_HEX 13165   FALSE
## 5  C05  Emily   C   5 TRUE Consensus_FAM WTspecific_HEX 14109   FALSE
##   drops_outlier drops_empty drops_non_empty drops_empty_fraction concentration
## 1             2       13690            2130                0.865           170
## 2             0       12879            1377                0.903           120
## 3             0       14126            1251                0.919            99
## 4             1          NA              NA                   NA            NA
## 5             0          NA              NA                   NA            NA
##   drops_positive drops_negative
## 1           1889            239
## 2           1281             96
## 3           1090            161
## 4              0              0
## 5              0              0</code></pre>
<p><img src="data:image/png;base64,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" width="50%" /><img src="data:image/png;base64,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" width="50%" /></p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
